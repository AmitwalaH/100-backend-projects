<!doctype html>
<html>
  <head>
    <title>Nexus Coordination Dashboard</title>
    <script src="http://localhost:3000/socket.io/socket.io.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>

  <body class="bg-slate-950 text-slate-300 font-mono p-4 md:p-10">
    <div
      class="max-w-2xl mx-auto border border-slate-800 rounded-xl overflow-hidden shadow-2xl"
    >
      <!-- HEADER -->
      <div
        class="bg-slate-900 p-4 border-b border-slate-800 flex justify-between items-center"
      >
        <h1 class="text-blue-500 font-bold">NEXUS_v1.0</h1>
        <div id="led" class="w-3 h-3 rounded-full bg-red-600"></div>
      </div>

      <!-- TERMINAL -->
      <div
        id="terminal"
        class="h-80 overflow-y-auto p-4 space-y-2 text-sm bg-black/40"
      >
        <p class="text-slate-600 italic">Initializing handshake...</p>
      </div>

      <!-- CONTROLS -->
      <div class="p-4 bg-slate-900/50 border-t border-slate-800 space-y-4">
        <div class="flex gap-2">
          <input
            id="room"
            type="text"
            placeholder="CHANNEL_ID"
            class="flex-1 bg-black border border-slate-700 rounded px-3 py-2 text-sm outline-none focus:border-blue-500"
          />
          <button
            id="syncBtn"
            class="bg-blue-700 hover:bg-blue-600 text-white px-4 py-2 rounded text-xs font-bold transition-all"
          >
            SYNC
          </button>
        </div>

        <div class="flex gap-2">
          <input
            id="msg"
            type="text"
            placeholder="TRANSMIT_DATA"
            class="flex-1 bg-black border border-slate-700 rounded px-3 py-2 text-sm outline-none focus:border-green-500"
          />
          <button
            id="pushBtn"
            class="bg-green-700 hover:bg-green-600 text-white px-4 py-2 rounded text-xs font-bold transition-all"
          >
            PUSH
          </button>
        </div>
      </div>
    </div>

    <script>
      const socket = io("http://localhost:3000");

      const terminal = document.getElementById("terminal");
      const led = document.getElementById("led");
      const syncBtn = document.getElementById("syncBtn");
      const pushBtn = document.getElementById("pushBtn");

      let activeRoom = "";

      const log = (msg, color = "text-slate-400") => {
        const p = document.createElement("p");
        p.className = color;
        p.innerHTML = `<span class="opacity-30 mr-2">[${new Date().toLocaleTimeString()}]</span> ${msg}`;
        terminal.appendChild(p);
        terminal.scrollTop = terminal.scrollHeight;
      };

      // CONNECTION EVENTS
      socket.on("connect", () => {
        led.classList.replace("bg-red-600", "bg-green-500");
        log("Engine synchronized.", "text-green-500");
      });

      socket.on("disconnect", () => {
        led.classList.replace("bg-green-500", "bg-red-600");
        log("Connection lost.", "text-red-500");
      });

      // ROOM MESSAGE EVENT
      socket.on("room-update", (data) => {
        const isMe = data.sender === socket.id;
        log(
          `<strong>${isMe ? "YOU" : "NODE"}</strong>: ${data.content}`,
          "text-blue-400",
        );
      });

      // NOTIFICATIONS (Matches backend)
      socket.on("notification", (data) => {
        log(data.message, "text-yellow-500 italic");
      });

      // SYNC FUNCTION
      syncBtn.addEventListener("click", () => {
        const room = document.getElementById("room").value.trim();
        if (!room) return;

        activeRoom = room;
        socket.emit("join-room", activeRoom);
        log(`Channel locked: ${activeRoom}`, "text-yellow-500");
      });

      // PUSH FUNCTION
      pushBtn.addEventListener("click", () => {
        const msg = document.getElementById("msg").value.trim();
        if (!msg || !activeRoom) return;

        socket.emit("send-data", {
          room: activeRoom,
          data: msg,
        });

        document.getElementById("msg").value = "";
      });
    </script>
  </body>
</html>
